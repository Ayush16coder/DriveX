{% extends 'DriveX/base.html' %}
{% load static %}

{% block content %}
<div style="max-width: 800px; margin: 40px auto; padding: 20px;">

    <!-- Header -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div>
            <a href="{% url 'Renter:dashboard' %}" style="color: #64748b; text-decoration: none; font-size: 0.9rem;">
                <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
            </a>
            <h1 style="color: #1e293b; margin: 0.5rem 0 0 0;">Booking Details</h1>
            <p style="color: #64748b; margin: 0;">ID: #{{ booking.id }}</p>
        </div>
        <div style="text-align: right;">
            <span class="status-badge {{ booking.status }}" style="font-size: 1rem; padding: 0.5rem 1rem;">
                {{ booking.get_status_display }}
            </span>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">

        <!-- Vehicle Card -->
        <div class="card">
            <h3
                style="margin-bottom: 1.5rem; color: #334155; border-bottom: 2px solid #f1f5f9; padding-bottom: 0.5rem;">
                Vehicle Information</h3>

            {% if booking.vehicle.image %}
            <img src="{{ booking.vehicle.image.url }}" alt="{{ booking.vehicle.name }}"
                style="width: 100%; height: 200px; object-fit: cover; border-radius: 12px; margin-bottom: 1.5rem;">
            {% endif %}

            <h2 style="color: #1e293b; margin-bottom: 0.5rem;">{{ booking.vehicle.brand }} {{ booking.vehicle.model }}
            </h2>
            <p style="color: #64748b; margin-bottom: 1.5rem;">
                {{ booking.vehicle.vehicle_type|title }} â€¢ {{ booking.vehicle.license_plate }}
            </p>

            <div style="background: #f8fafc; padding: 1rem; border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span style="color: #64748b;">Daily Rate</span>
                    <span style="font-weight: 600; color: #1e293b;">${{ booking.vehicle.price_per_day }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span style="color: #64748b;">Duration</span>
                    <span style="font-weight: 600; color: #1e293b;">
                        {{ booking.start_date }} to {{ booking.end_date }}
                    </span>
                </div>
                <div style="border-top: 1px solid #e2e8f0; margin: 0.5rem 0;"></div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: #334155; font-weight: 600;">Total Price</span>
                    <span style="color: #3b82f6; font-weight: 700; font-size: 1.2rem;">${{ booking.total_price }}</span>
                </div>
            </div>
        </div>

        <!-- Owner & Journey Card -->
        <div class="card">
            <h3
                style="margin-bottom: 1.5rem; color: #334155; border-bottom: 2px solid #f1f5f9; padding-bottom: 0.5rem;">
                Owner Details</h3>

            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                {% if booking.vehicle.owner.profile_photo %}
                <img src="{{ booking.vehicle.owner.profile_photo.url }}" alt="Owner"
                    style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;">
                {% else %}
                <div
                    style="width: 60px; height: 60px; border-radius: 50%; background: #e2e8f0; display: flex; align-items: center; justify-content: center; color: #64748b;">
                    <i class="fa-solid fa-user" style="font-size: 1.5rem;"></i>
                </div>
                {% endif %}
                <div>
                    <h4 style="margin: 0; color: #1e293b;">
                        {{ booking.vehicle.owner.user.first_name }}
                        {{ booking.vehicle.owner.user.last_name }}
                    </h4>
                    <p style="margin: 0; color: #64748b; font-size: 0.9rem;">Car Owner</p>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; gap: 0.8rem; margin-bottom: 0.8rem; color: #334155;">
                    <i class="fa-solid fa-phone" style="color: #3b82f6; width: 20px;"></i>
                    <span>{{ booking.vehicle.owner.mobile }}</span>
                </div>
                <!-- Add address or other details if needed -->
            </div>

            {% if booking.status == 'confirmed' and booking.vehicle.owner.payment_qr %}
            <div
                style="text-align: center; background: #fffbeb; padding: 1.5rem; border-radius: 12px; border: 1px solid #fcd34d;">
                <h4 style="color: #b45309; margin-bottom: 1rem;">Payment QR Code</h4>
                <img src="{{ booking.vehicle.owner.payment_qr.url }}" alt="Payment QR"
                    style="width: 150px; height: 150px; object-fit: contain; background: white; padding: 0.5rem; border-radius: 8px;">
                <p style="color: #b45309; font-size: 0.8rem; margin-top: 0.5rem;">Scan to pay owner directly</p>
            </div>
            {% endif %}

            {% if booking.status == 'pending' or booking.status == 'confirmed' %}
            <div style="margin-top: 2rem; border-top: 1px solid #f1f5f9; padding-top: 1.5rem;">
                <a href="{% url 'Renter:cancel_booking' booking.id %}"
                    onclick="return confirm('Are you sure you want to cancel this booking?')"
                    style="display: block; width: 100%; text-align: center; padding: 0.8rem; background: #fee2e2; color: #ef4444; border-radius: 8px; text-decoration: none; font-weight: 600; border: 1px solid #fecaca; transition: all 0.2s;">
                    Cancel Booking
                </a>
            </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}